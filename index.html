<!DOCTYPE html>
<html>
<head>
    <title>PM2 Monitor</title>
    <style>
        body { font-family: Arial, sans-serif; background: #111; color: #eee; }
        table { border-collapse: collapse; width: 100%; margin-top: 10px; }
        th, td { border: 1px solid #555; padding: 5px; text-align: left; }
        th { background: #333; }
        button { padding: 5px 10px; background: #28a745; color: white; border: none; cursor: pointer; }
        button:hover { background: #218838; }
        pre { background: #000; color: #0f0; padding: 10px; height: 300px; overflow-y: scroll; }
    </style>
</head>
<body>
    <h1>PM2 Monitoring</h1>
    <table id="pm2-table">
        <tr>
            <th>App Name</th>
            <th>Status</th>
            <th>Uptime</th>
            <th>CPU</th>
            <th>Memory</th>
            <th>Logs</th>
        </tr>
    </table>

    <h2>Logs</h2>
    <pre id="logs"></pre>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();

        socket.on('pm2-data', (list) => {
            const table = document.getElementById('pm2-table');
            table.innerHTML = `
                <tr>
                    <th>App Name</th>
                    <th>Status</th>
                    <th>Uptime</th>
                    <th>CPU</th>
                    <th>Memory</th>
                    <th>Logs</th>
                </tr>
            `;

            list.forEach(proc => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${proc.name}</td>
                    <td>${proc.pm2_env.status}</td>
                    <td>${Math.floor((Date.now() - proc.pm2_env.pm_uptime) / 1000)}s</td>
                    <td>${proc.monit.cpu}%</td>
                    <td>${(proc.monit.memory / 1024 / 1024).toFixed(2)} MB</td>
                    <td><button onclick="getLogs('${proc.name}')">Lihat Log</button></td>
                `;
                table.appendChild(row);
            });
        });

        socket.on('pm2-log', (log) => {
            const logsEl = document.getElementById('logs');
            logsEl.textContent += log;
            logsEl.scrollTop = logsEl.scrollHeight;
        });

        function getLogs(appName) {
            document.getElementById('logs').textContent = '';
            socket.emit('get-logs', appName);
        }
    </script>
</body>
</html>
