<!DOCTYPE html>
<html>
<head>
    <title>PM2 Panel</title>
    <style>
        body { font-family: Arial; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ccc; padding: 6px; text-align: left; }
        button { padding: 5px; margin: 2px; }
    </style>
</head>
<body>
    <h1>PM2 Process Manager</h1>
    <table id="processTable">
        <thead>
            <tr>
                <th>Name</th>
                <th>Status</th>
                <th>CPU</th>
                <th>Memory</th>
                <th>Uptime</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        async function loadData() {
            const res = await fetch('/api/list');
            const data = await res.json();
            const tbody = document.querySelector('#processTable tbody');
            tbody.innerHTML = '';

            data.forEach(proc => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${proc.name}</td>
                    <td>${proc.pm2_env.status}</td>
                    <td>${proc.monit.cpu}%</td>
                    <td>${(proc.monit.memory/1024/1024).toFixed(2)} MB</td>
                    <td>${Math.floor((Date.now() - proc.pm2_env.pm_uptime) / 1000)}s</td>
                    <td>
                        <button onclick="action('${proc.name}','start')">Start</button>
                        <button onclick="action('${proc.name}','stop')">Stop</button>
                        <button onclick="action('${proc.name}','restart')">Restart</button>
                        <button onclick="action('${proc.name}','delete')">Delete</button>
                        <button onclick="viewLogs('${proc.name}')">Logs</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        async function action(name, act) {
            await fetch('/api/action', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, action: act })
            });
            loadData();
        }

        function viewLogs(name) {
            window.open(`/api/logs/${name}`, '_blank');
        }

        loadData();
        setInterval(loadData, 5000);
    </script>
</body>
</html>
